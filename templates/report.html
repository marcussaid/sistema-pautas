{% extends 'base.html' %}
{% block content %}
<div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-8">Relatório de Demandas</h1>

    {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for message in messages %}
                <div class="mb-4 p-4 {% if 'sucesso' in message.lower() %}bg-green-100 text-green-700{% else %}bg-red-100 text-red-700{% endif %} rounded">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <form method="GET" action="{{ url_for('report') }}" class="mb-4">
        <input type="text" name="search" placeholder="Pesquisar..." value="{{ search_query }}" class="px-3 py-2 border rounded">
        <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
            Buscar
        </button>
    </form>

    <a href="{{ url_for('export') }}" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded mb-4 inline-block">
        Exportar para CSV
    </a>

    <table class="min-w-full bg-white border border-gray-300">
        <thead>
            <tr>
                <th class="py-2 px-4 border-b">Data</th>
                <th class="py-2 px-4 border-b">Demanda</th>
                <th class="py-2 px-4 border-b">Assunto</th>
                <th class="py-2 px-4 border-b">Local</th>
                <th class="py-2 px-4 border-b">Status</th>
                <th class="py-2 px-4 border-b">Data de Registro</th>
                <th class="py-2 px-4 border-b">Último Editor</th>
                <th class="py-2 px-4 border-b">Data da Edição</th>
                <th class="py-2 px-4 border-b">Ações</th>
            </tr>
        </thead>
        <tbody>
            {% for registro in registros %}
            <tr>
                <td class="py-2 px-4 border-b">{{ registro['data'] }}</td>
                <td class="py-2 px-4 border-b">{{ registro['demanda'] }}</td>
                <td class="py-2 px-4 border-b">{{ registro['assunto'] }}</td>
                <td class="py-2 px-4 border-b">{{ registro['local'] or 'N/A' }}</td>
                <td class="py-2 px-4 border-b">{{ registro['status'] }}</td>
                <td class="py-2 px-4 border-b">{{ registro['data_registro'].strftime('%d/%m/%Y %H:%M') }}</td>
                <td class="py-2 px-4 border-b">{{ registro['ultimo_editor'] or 'N/A' }}</td>
                <td class="py-2 px-4 border-b">{{ registro['data_ultima_edicao'].strftime('%d/%m/%Y %H:%M') if registro['data_ultima_edicao'] else 'N/A' }}</td>
                <td class="py-2 px-4 border-b">
                    <form method="POST" action="{{ url_for('delete', id=registro['id']) }}">
                        <button type="submit" class="text-red-500">Excluir</button>
                    </form>
                    <a href="{{ url_for('edit', id=registro['id']) }}" class="text-blue-500">Editar</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
